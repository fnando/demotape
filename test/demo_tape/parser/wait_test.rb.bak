# frozen_string_literal: true

require "test_helper"

class ParserWaitTest < Minitest::Test
  def parse(source)
    DemoTape::Parser.new.parse(source)
  end

  test "parses Wait with seconds" do
    result = parse(%[Wait 2s\n])

    command = result[0]
    assert_equal :command, command[:type]
    assert_equal 4, command[:tokens].size

    assert_instance_of DemoTape::Token::Identifier, command[:tokens][0]
    assert_equal "Wait", command[:tokens][0].value

    assert_instance_of DemoTape::Token::Space, command[:tokens][1]

    assert_instance_of DemoTape::Token::Number, command[:tokens][2]
    assert_equal 2, command[:tokens][2].value

    assert_instance_of DemoTape::Token::TimeUnit, command[:tokens][3]
    assert_equal "s", command[:tokens][3].value
  end

  test "parses Wait with milliseconds" do
    result = parse(%[Wait 500ms\n])

    command = result[0]
    assert_equal :command, command[:type]
    assert_equal 4, command[:tokens].size

    assert_instance_of DemoTape::Token::Number, command[:tokens][2]
    assert_equal 500, command[:tokens][2].value

    assert_instance_of DemoTape::Token::TimeUnit, command[:tokens][3]
    assert_equal "ms", command[:tokens][3].value
  end

  test "parses Wait with decimal seconds" do
    result = parse(%[Wait 1.5s\n])

    command = result[0]
    assert_equal :command, command[:type]
    assert_equal 4, command[:tokens].size

    assert_instance_of DemoTape::Token::Number, command[:tokens][2]
    assert_in_delta(1.5, command[:tokens][2].value)

    assert_instance_of DemoTape::Token::TimeUnit, command[:tokens][3]
    assert_equal "s", command[:tokens][3].value
  end

  test "parses Wait without unit (plain number)" do
    result = parse(%[Wait 3\n])

    command = result[0]
    assert_equal :command, command[:type]

    assert_instance_of DemoTape::Token::Number, command[:tokens][2]
    assert_equal 3, command[:tokens][2].value
  end
end
